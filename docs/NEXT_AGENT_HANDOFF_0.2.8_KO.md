# Next Agent Handoff (0.2.8)

## 목적
- 사용자 기대 수준(Agent Client 유사 UX)에 맞게 Local AI Chat 품질을 끌어올린다.
- 특히 다음 3가지를 최우선으로 개선한다.
  1. UI 완성도(가독성, 정보 밀도, 일관성)
  2. 출력 품질(표/체크리스트/요약 구조화)
  3. 진행 상태 체감(Thinking/중간 단계 노출)

## 현재 릴리즈 상태
- 버전: `0.2.8`
- 반영 파일:
  - `src/main.ts`
  - `styles.css`
  - `README.md`
  - `README_KO.md`
  - `CHANGELOG.md`
  - `manifest.json`
  - `package.json`
  - `versions.json`

## 이미 반영된 내용
- 채팅 UI 재정렬(헤더/툴바/메시지/입력부 분리)
- Source 링크 클릭 열기
- 채팅 thread 자동 동기화 저장
- markdown 렌더링(표/리스트/헤더 표시)
- Thinking 카드(진행 상태 및 일부 thinking 텍스트 반영)

## 사용자 불만 핵심(해결 미완료/체감 부족)
1. Agent Client 대비 UI 고급감 부족
- 정보가 많아도 시선 흐름이 덜 정돈됨.
- 메시지 카드/패널 액션/메타 정보 계층이 아직 투박하다고 느낌.

2. 같은 로컬 모델인데 출력 수준 차이 큼
- 표/구조화가 항상 나오지 않음.
- 질문 문맥에 따라 응답 품질 편차가 큼.

3. “생각 중” 경험 차이
- Agent Client처럼 툴 단계/행동 카드가 촘촘히 보이지 않음.
- 현재는 내부 파이프라인 이벤트를 요약해서 보여주는 수준.

## 기술적 원인 요약
1. 생성 API가 `/api/generate` 중심
- 역할 메시지(chat messages) 기반 제어가 제한적.
- 툴 이벤트 스트림 풍부도가 낮음.

2. RAG 품질 편차
- 스니펫 추출이 라인 기반이라 문맥 손실 발생 가능.
- 재랭킹이 경로 토큰 가중치에 영향을 받음.

3. UI 구조/스타일은 개선됐지만 “에이전트형 인터랙션 레이어”는 미완성
- 툴 실행 카드, 액션 로그, 단계별 진행률 등 전용 컴포넌트 부재.

## 다음 타자에게 권장하는 구현 우선순위
1. API 레이어
- 가능하면 Ollama `/api/chat` 경로 추가(역할 기반 메시지 유지).
- 시스템 프롬프트와 최근 대화를 분리해 전달.
- 스트림 이벤트 타입을 분리 수집:
  - thinking
  - retrieval
  - generation
  - warnings/errors

2. 렌더링 레이어
- markdown 렌더 결과에 대한 테마 독립 스타일 가이드 확립
  - table, code, blockquote, list spacing
- Thinking을 단일 덩어리가 아닌 “타임라인 이벤트” 카드로 분해
  - 시간/단계/세부 로그

3. RAG 레이어
- snippet 추출을 문단/헤딩 단위로 재작성
- rerank 시 path 가중치 축소, 질의-본문 매칭 강화
- top-k/fallback 정책을 질문 유형(비교/요약/계획)에 따라 가변화

4. 품질 가드
- 응답 스키마 힌트 강화
  - 비교/계획 질문이면 표 또는 체크리스트 강제
- 답변 후 사후 정리 단계(표 생성 보정) 추가

## 재현 시나리오(사용자 체감 테스트)
1. 비교 질문:
- “A와 B를 비용/리스크/실행난이도로 비교해줘”
- 기대: markdown 표

2. 실행 계획 질문:
- “앞으로 3개월 준비계획 알려줘”
- 기대: 체크리스트 + 우선순위

3. 근거 추적 질문:
- “방금 결론의 출처만 5개 링크로 보여줘”
- 기대: 소스 링크 카드 정상 표시

## 다음 스레드에서 바로 붙여넣을 프롬프트(권장)
```text
레포: auto-linker (현재 워크스페이스 루트)

목표:
1) Local AI Chat을 Agent Client 수준에 근접하게 개선
2) 답변 구조화(표/체크리스트) 일관성 강화
3) Thinking/진행상태를 타임라인 카드로 개선

필수 제약:
- 보안 우선(로컬 엔드포인트 기본 유지)
- 기존 기능 회귀 금지(자동 thread sync, source 링크, cleanup 경로 설정)
- 변경 후 npm run release:check 통과

우선 작업:
- /api/chat 기반 경로 추가(가능 시)
- RAG snippet 추출을 문단/헤딩 중심으로 개선
- 렌더러와 CSS를 테마 독립적으로 보정(표/소스 카드 깨짐 방지)
```
