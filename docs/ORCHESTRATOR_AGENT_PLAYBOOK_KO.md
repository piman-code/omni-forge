# Orchestrator 중심 Agent 활용 플레이북 (KO)

## 1) 핵심 결론

- 현재 설정만으로는 `linked`를 완전 all-to-all로 **보장**하지 못했습니다.
- 플러그인 코드에 `Force all-to-all linked (deterministic)` 옵션을 추가했고, 이 모드에서는 각 노트의 `linked`가 선택된 다른 모든 노트로 고정됩니다(`maxLinked` 무시).
- 추가로 all-to-all 모드에서는 시맨틱 후보 계산을 건너뛰도록 최적화해, 불필요한 로컬 메모리 사용을 줄였습니다.

## 2) 첨부 화면 점검 결과

### 2-1. Semantic 설정 화면(1번째 첨부)

- `Semantic top-k candidates=24`, `min similarity=0.25`, `source max chars=5000`는 일반적으로 유효한 범위입니다.
- 다만 선택 노트 수가 매우 많으면(예: 700개) 시맨틱 계산 자체가 메모리/시간을 크게 사용합니다.
- all-to-all를 사용할 때는 이번 패치로 시맨틱 후보 계산을 건너뛰므로 대규모 실행에서 체감이 개선됩니다.

### 2-2. Role 모델 화면(2번째 첨부)

- `Ask (vision)`에 `qwen3:14b`가 추천되는 현상은, 감지된 목록에 비전 모델이 없거나 우선순위가 낮게 잡힌 경우 발생할 수 있습니다.
- 이번 패치에서 `ask_vision` 추천 점수를 비전 모델 우선으로 높였습니다.
- 여전히 텍스트 모델이 추천된다면, 로컬 모델 감지 목록에 비전 모델이 실제로 잡히는지 먼저 확인해야 합니다.
  - 예: 이름에 `vision`, `llava`, `qwen...vl`, `pixtral`, `internvl` 패턴이 있어야 비전으로 인식됩니다.

## 3) 권장 기본 세팅(Orchestrator 중심)

- `qaPipelinePreset`: `orchestrator_auto_route`
- `orchestrator model`: 고성능 일반 모델(예: `qwen3:32b`)
- `coder model`: 코드 특화 모델(예: `qwen3-coder:30b`)
- `architect model`: 설계/구조 특화용 대형 일반 모델
- `safeguard model`: 안전 검증 전용 모델(예: `gpt-oss-safeguard:20b`)
- `ask_vision model`: 비전 가능한 모델이 감지되면 해당 모델로 고정 권장

## 4) 상황별 활용 예시 (7가지)

### 상황 1. 신규 기능 설계 + 구현 시작

- 목표: 요구사항을 구조화하고 구현 단위까지 분해
- 권장 파이프라인: `orchestrator -> architect -> coder -> safeguard`
- 질문 예시:
  - "이 기능을 2주 내 배포 가능한 구조로 쪼개고, API/DB 변경점과 테스트 전략까지 제시해줘."
- 기대 결과:
  - 오케스트레이터가 단계/의존성 정리
  - 아키텍트가 설계 대안/트레이드오프 정리
  - 코더가 구현 순서/코드 레벨 체크리스트 작성
  - 세이프가드가 과장/근거 부족 문장 제거

### 상황 2. 장애/버그 원인 분석

- 목표: 재현 가능한 디버깅 경로와 복구 우선순위 확보
- 권장 파이프라인: `orchestrator_auto_route` (질문에 버그 신호가 있으면 debugger/coder 자동 라우팅)
- 질문 예시:
  - "간헐적으로 메모리 급증이 발생한다. 재현 실험 설계와 우선 확인할 로그 포인트를 정리해줘."
- 기대 결과:
  - 오케스트레이터가 조사 순서 정의
  - 디버거/코더가 재현 시나리오와 계측 포인트 구체화
  - 세이프가드가 확인 불가 가설을 명시적으로 분리

### 상황 3. 보안/개인정보 점검 답변 작성

- 목표: 정책 준수 관점으로 위험 항목을 보수적으로 정리
- 권장 파이프라인: `orchestrator -> safeguard`
- 질문 예시:
  - "이 워크플로에서 개인정보가 외부로 전송될 수 있는 경로를 위험도별로 정리해줘."
- 기대 결과:
  - 오케스트레이터가 범위/분류 프레임 제공
  - 세이프가드가 근거 없는 주장 제거, 보수적 문장으로 정제

### 상황 4. 대규모 노트 상호연결 일괄 처리(그래프 강화)

- 목표: 선택한 노트 집합의 `linked`를 완전 상호 연결
- 권장 설정:
  - `Analyze linked`: ON
  - `Force all-to-all linked (deterministic)`: ON
  - 대규모 실행 전 백업 ON
- 질문 예시:
  - "이 선택 집합은 그래프 밀도를 우선한다. linked를 전부 상호 연결하고, 태그/토픽은 보수적으로 유지해줘."
- 기대 결과:
  - `linked`는 모델 변동 없이 결정적으로 생성
  - 대규모 실행에서 시맨틱 후보 계산 생략으로 부담 완화

### 상황 5. 문서/회의록 기반 구현 지시서 생성

- 목표: 산재한 노트를 실행 가능한 작업지시로 통합
- 권장 파이프라인: `orchestrator -> coder -> safeguard`
- 질문 예시:
  - "회의록과 TODO 노트들을 합쳐서 이번 스프린트 실행 항목과 담당자 체크리스트로 변환해줘."
- 기대 결과:
  - 오케스트레이터가 우선순위/의존성 정렬
  - 코더가 구현 단위·검증 절차 상세화
  - 세이프가드가 불확실 항목을 `정보 부족`으로 표시

### 상황 6. 아키텍처 의사결정 문서(ADR) 작성

- 목표: 선택지 비교 + 채택 근거 문서화
- 권장 파이프라인: `orchestrator -> architect -> safeguard`
- 질문 예시:
  - "검색 성능 개선을 위해 인덱싱 전략 3개를 비교하고, 우리 규모 기준 권장안을 ADR 형태로 작성해줘."
- 기대 결과:
  - 오케스트레이터가 비교 축 정의
  - 아키텍트가 trade-off와 마이그레이션 경로 제시
  - 세이프가드가 검증되지 않은 수치/주장 정리

### 상황 7. 비전 노트 정리(이미지 캡처/다이어그램 해석 포함)

- 목표: 이미지 포함 자료를 텍스트 지식으로 구조화
- 권장 파이프라인: `ask_vision -> orchestrator -> safeguard`
- 질문 예시:
  - "이 다이어그램(이미지) 설명을 노트 구조에 맞게 요약하고, 실행 체크리스트로 바꿔줘."
- 기대 결과:
  - 비전 모델이 이미지 맥락 추출(호스트 입력 지원 전제)
  - 오케스트레이터가 실행형 산출물로 재구성
  - 세이프가드가 근거 범위 내로 보정

## 5) 운영 체크리스트

- 실행 전:
  - 선택 노트 수가 많으면 먼저 백업
  - `Large selection warning`은 성능 보호 장치이므로 무시보다 분할 실행이 안전
- 모델:
  - `ask_vision`은 비전 모델 감지 시 해당 모델 고정 권장
  - 비전 모델이 없으면 텍스트 모델이 대체 추천될 수 있음
- 결과 품질:
  - 최종 검증은 `safeguard` 패스를 마지막에 배치
  - 확인되지 않은 내용은 `정보 부족`으로 남기는 정책 유지

